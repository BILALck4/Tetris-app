image: docker:latest

services:
  - docker:dind

stages:
  - build
  - test
  - notify

# Build stage
build:
  stage: build 
  script:
    - docker buildx build -t bilalck/tetris-app:latest .
    - docker run  --rm bilalck4/tetris-app  
  artifacts:
    paths:
      - bin/  
# Test stage
test_job:
  stage: test
  image: bilalck4/tetris-app
  script:
    - ant test  # Run tests and generate reports
  artifacts:
    paths:
      - test-reports/  # Save test reports as artifacts

#deploy_job:
#  stage: deploy
#  script:
#    - echo "Deploying the application..."
#    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin 
#    - docker push bilalck4/tetris-app:latest
#  only:
#    - main 

notify-discord:
  stage: notify
  image: bilalck4/tetris-app
  script:
    - curl -H "Content-Type: application/json" -d '{"content": "ðŸŽ‰ Le pipeline GitLab a rÃ©ussi ! Build & DÃ©ploiement de l application **Tetris**."}'    "https://discord.com/api/webhooks/1296454102598942811/j_UAjhRF0u4t1q10LxiK5Qj90B5bNXL_YM4Tcuz4vGDoXourtN9fIGfQ_lKF-OjvBkld"

  only:
    - main

