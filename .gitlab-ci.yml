image: openjdk:17

# Define stages in the pipeline
stages:
  - build
  - test
  - package
  - deploy

# Build stage: Compile the Java code using Ant
build:
  stage: build
  script:
    - echo "Building the project..."
    - apt-get update && apt-get install -y ant
    - ant clean compile
  artifacts:
    paths:
      - bin/

# Test stage: Run tests using JUnit and Ant
test:
  stage: test
  script:
    - echo "Running tests..."
    - ant test-reports
  artifacts:
    paths:
      - test-reports/
    reports:
      junit: test-reports/TESTS-TestSuites.xml

# Package stage: Create the JAR file using Ant
package:
  stage: package
  script:
    - echo "Packaging the application into a JAR..."
    - ant dist
  artifacts:
    paths:
      - bin/Tetris.jar

# Deploy stage: Deploy the JAR file to a remote server
deploy:
  stage: deploy
  script:
    - echo "DÃ©ploiement en cours..."
    - scp -r bin/ e22409386@gitlab-depinfo-2024.univ-brest.fr:/home/e22409386/tetris_project/
  only:
    - main  # Adjust this if you want to deploy from other branches as well
