stages:
  - build
  - test
  - docs
  - dist
  - deploy

build:
  stage: build
  image: registry.gitlab.com/e22409386/TP-ANT-JUnit/image1:tag
  script:
    - echo "Building the project with Ant..."
    - export ANT_HOME=/usr/local/apache-ant
    - export PATH=$PATH:$ANT_HOME/bin
    - ant compile
  only:
    - main
    - develop
  artifacts:
    paths:
      - bin/
      - libs/
    expire_in: 1 week

test:
  stage: test
  image: registry.gitlab.com/your-username/your-project/your-image-name:your-tag
  script:
    - echo "Running tests with Ant..."
    - ant test
  only:
    - main
    - develop
  dependencies:
    - build
  artifacts:
    paths:
      - test-reports/
    reports:
      junit: test-reports/TESTS-TestSuites.xml

javadoc:
  stage: docs
  image: registry.gitlab.com/e22409386/TP-ANT-JUnit/image1:tag
  script:
    - echo "Generating Javadoc with Ant..."
    - ant javadoc
  only:
    - main
    - develop
  dependencies:
    - build
  artifacts:
    paths:
      - javadoc/
    expire_in: 1 week

dist:
  stage: dist
  image: registry.gitlab.com/e22409386/TP-ANT-JUnit/image1:tag
  script:
    - echo "Packaging the project into a JAR file with Ant..."
    - ant dist
  only:
    - main
    - develop
  dependencies:
    - build
  artifacts:
    paths:
      - bin/Tetris.jar
    expire_in: 1 week

deploy:
  stage: deploy
  image: registry.gitlab.com/e22409386/TP-ANT-JUnit/image1:tag
  script:
    - echo "Deploying the project..."
    - scp bin/Tetris.jar e22409386@gitlab-depinfo-2024.univ-brest.fr:/home/e22409386/tetris_project/
  only:
    - main
